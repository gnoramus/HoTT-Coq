<html>
<head>
<title>Core.v</title>
<style>
.time {
  background-color: #ffaaaa;
  height: 100%;
  z-index: -1;
  position: absolute;
}
.code {
  z-index: 0;
  position: relative;
  border-style: solid;
  border-color: transparent;
  border-width: 1px;
}
.code:hover {
  border-style: solid;
  border-color: black;
  border-width: 1px;
}
pre {
  margin: 1px;
}
</style>
</head>
<body>
<h1>Timings for Core.v</h1>

<div class="code" title="File: Core.v
Line: 1
Time: 0.013s">
<div class="time" style="width: 100%"></div>
<pre>Require Import Basics.</pre>
</div>
<div class="code" title="File: Core.v
Line: 1
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(* ** Binary Positive Integers *)

(** Most of this file has been adapted from the coq standard library for positive binary integers. *)

(** Here we define the inductive type of positive binary numbers. *)</pre>
</div>
<div class="code" title="File: Core.v
Line: 7
Time: 0.001s">
<div class="time" style="width: 7.6923076923077%"></div>
<pre>Inductive Pos : Type0 :=
  | xH : Pos
  | x0 : Pos -&gt; Pos
  | x1 : Pos -&gt; Pos.</pre>
</div>
<div class="code" title="File: Core.v
Line: 10
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Declare Scope positive_scope.</pre>
</div>
<div class="code" title="File: Core.v
Line: 12
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Delimit Scope positive_scope with pos.</pre>
</div>
<div class="code" title="File: Core.v
Line: 13
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Here are some notations that let us right binary positive integers more easily. *)</pre>
</div>
<div class="code" title="File: Core.v
Line: 15
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Notation "1" := xH : positive_scope.</pre>
</div>
<div class="code" title="File: Core.v
Line: 15
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Notation "p ~ 1" := (x1 p)
 (at level 7, left associativity, format "p '~' '1'") : positive_scope.</pre>
</div>
<div class="code" title="File: Core.v
Line: 17
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Notation "p ~ 0" := (x0 p)
 (at level 7, left associativity, format "p '~' '0'") : positive_scope.</pre>
</div>
<div class="code" title="File: Core.v
Line: 19
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Local Open Scope positive_scope.</pre>
</div>
<div class="code" title="File: Core.v
Line: 21
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Successor *)</pre>
</div>
<div class="code" title="File: Core.v
Line: 23
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Fixpoint pos_succ x :=
  match x with
    | p~1 =&gt; (pos_succ p)~0
    | p~0 =&gt; p~1
    | 1 =&gt; 1~0
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 28
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Peano induction (due to Daniel Schepler) *)</pre>
</div>
<div class="code" title="File: Core.v
Line: 30
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Fixpoint pos_peano_ind (P : Pos -&gt; Type) (a : P 1)
  (f : forall p, P p -&gt; P (pos_succ p)) (p : Pos) : P p
  := let f2 := pos_peano_ind (fun p =&gt; P (p~0))
    (f _ a) (fun p (x : P p~0) =&gt; f _ (f _ x))
  in match p with
      | q~1 =&gt; f _ (f2 q)
      | q~0 =&gt; f2 q
      | 1 =&gt; a
     end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 38
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Computation rules for Peano induction *)</pre>
</div>
<div class="code" title="File: Core.v
Line: 40
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition pos_peano_ind_beta_1 (P : Pos -&gt; Type) (a : P 1)
  (f : forall p, P p -&gt; P (pos_succ p))
  : pos_peano_ind P a f 1 = a := idpath.</pre>
</div>
<div class="code" title="File: Core.v
Line: 42
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition pos_peano_ind_beta_pos_succ (P : Pos -&gt; Type) (a : P 1)
  (f : forall p, P p -&gt; P (pos_succ p)) (p : Pos)
  : pos_peano_ind P a f (pos_succ p) = f _ (pos_peano_ind P a f p).</pre>
</div>
<div class="code" title="File: Core.v
Line: 46
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Core.v
Line: 47
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  revert P a f.</pre>
</div>
<div class="code" title="File: Core.v
Line: 48
Time: 0.001s">
<div class="time" style="width: 7.6923076923077%"></div>
<pre>
  induction p; trivial.</pre>
</div>
<div class="code" title="File: Core.v
Line: 49
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros P a f.</pre>
</div>
<div class="code" title="File: Core.v
Line: 50
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  srapply IHp.</pre>
</div>
<div class="code" title="File: Core.v
Line: 51
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Core.v
Line: 52
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition pos_peano_rec (P : Type)
  : P -&gt; (Pos -&gt; P -&gt; P) -&gt; Pos -&gt; P
  := pos_peano_ind (fun _ =&gt; P).</pre>
</div>
<div class="code" title="File: Core.v
Line: 56
Time: 0.001s">
<div class="time" style="width: 7.6923076923077%"></div>
<pre>

Definition pos_peano_rec_beta_pos_succ (P : Type)
  (a : P) (f : Pos -&gt; P -&gt; P) (p : Pos)
  : pos_peano_rec P a f (pos_succ p) = f p (pos_peano_rec P a f p)
  := pos_peano_ind_beta_pos_succ (fun _ =&gt; P) a f p.</pre>
</div>
<div class="code" title="File: Core.v
Line: 61
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Properties of constructors *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 64
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition x0_inj {z w : Pos} (p : x0 z = x0 w) : z = w
  := transport (fun s =&gt; z = (
    match s with xH =&gt; w | x0 a =&gt; a | x1 a =&gt; w end)) p idpath.</pre>
</div>
<div class="code" title="File: Core.v
Line: 66
Time: 0.001s">
<div class="time" style="width: 7.6923076923077%"></div>
<pre>

Definition x1_inj {z w : Pos} (p : x1 z = x1 w) : z = w
  := transport (fun s =&gt; z = (
    match s with xH =&gt; w | x0 a =&gt; w | x1 a =&gt; a end)) p idpath.</pre>
</div>
<div class="code" title="File: Core.v
Line: 70
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition x0_neq_xH {z : Pos} : x0 z &lt;&gt; xH
  := fun p =&gt; transport (fun s =&gt;
    match s with xH =&gt; Empty | x0 a =&gt; z = a | x1 a =&gt; Empty end) p idpath.</pre>
</div>
<div class="code" title="File: Core.v
Line: 74
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition x1_neq_xH {z : Pos} : x1 z &lt;&gt; xH
  := fun p =&gt; transport (fun s =&gt;
    match s with xH =&gt; Empty | x0 a =&gt; Empty | x1 a =&gt; z = a end) p idpath.</pre>
</div>
<div class="code" title="File: Core.v
Line: 78
Time: 0.001s">
<div class="time" style="width: 7.6923076923077%"></div>
<pre>

Definition x0_neq_x1 {z w : Pos} : x0 z &lt;&gt; x1 w
  := fun p =&gt; transport (fun s =&gt;
    match s with xH =&gt; Empty | x0 a =&gt; z = a | x1 _ =&gt; Empty end) p idpath.</pre>
</div>
<div class="code" title="File: Core.v
Line: 82
Time: 0.001s">
<div class="time" style="width: 7.6923076923077%"></div>
<pre>

Definition xH_neq_x0 {z : Pos} : xH &lt;&gt; x0 z
  := x0_neq_xH o symmetry _ _.</pre>
</div>
<div class="code" title="File: Core.v
Line: 85
Time: 0.001s">
<div class="time" style="width: 7.6923076923077%"></div>
<pre>

Definition xH_neq_x1 {z : Pos} : xH &lt;&gt; x1 z
  := x1_neq_xH o symmetry _ _.</pre>
</div>
<div class="code" title="File: Core.v
Line: 88
Time: 0.001s">
<div class="time" style="width: 7.6923076923077%"></div>
<pre>

Definition x1_neq_x0 {z w : Pos} : x1 z &lt;&gt; x0 w
  := x0_neq_x1 o symmetry _ _.</pre>
</div>
<div class="code" title="File: Core.v
Line: 91
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** * Positive binary integers have decidable paths *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 94
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance decpaths_pos : DecidablePaths Pos.</pre>
</div>
<div class="code" title="File: Core.v
Line: 94
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Core.v
Line: 95
Time: 0.001s">
<div class="time" style="width: 7.6923076923077%"></div>
<pre>
  intros n; induction n as [|zn|on];
  intros m; induction m as [|zm|om].</pre>
</div>
<div class="code" title="File: Core.v
Line: 97
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  +</pre>
</div>
<div class="code" title="File: Core.v
Line: 98
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (inl idpath).</pre>
</div>
<div class="code" title="File: Core.v
Line: 98
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  +</pre>
</div>
<div class="code" title="File: Core.v
Line: 99
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (inr xH_neq_x0).</pre>
</div>
<div class="code" title="File: Core.v
Line: 99
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  +</pre>
</div>
<div class="code" title="File: Core.v
Line: 100
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (inr xH_neq_x1).</pre>
</div>
<div class="code" title="File: Core.v
Line: 100
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  +</pre>
</div>
<div class="code" title="File: Core.v
Line: 101
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (inr x0_neq_xH).</pre>
</div>
<div class="code" title="File: Core.v
Line: 101
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  +</pre>
</div>
<div class="code" title="File: Core.v
Line: 102
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> destruct (IHzn zm) as [p|q].</pre>
</div>
<div class="code" title="File: Core.v
Line: 102
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Core.v
Line: 103
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply inl, ap, p.</pre>
</div>
<div class="code" title="File: Core.v
Line: 103
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Core.v
Line: 104
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply inr; intro p.</pre>
</div>
<div class="code" title="File: Core.v
Line: 104
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      by apply q, x0_inj.</pre>
</div>
<div class="code" title="File: Core.v
Line: 105
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  +</pre>
</div>
<div class="code" title="File: Core.v
Line: 106
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (inr x0_neq_x1).</pre>
</div>
<div class="code" title="File: Core.v
Line: 106
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  +</pre>
</div>
<div class="code" title="File: Core.v
Line: 107
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (inr x1_neq_xH).</pre>
</div>
<div class="code" title="File: Core.v
Line: 107
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  +</pre>
</div>
<div class="code" title="File: Core.v
Line: 108
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (inr x1_neq_x0).</pre>
</div>
<div class="code" title="File: Core.v
Line: 108
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  +</pre>
</div>
<div class="code" title="File: Core.v
Line: 109
Time: 0.001s">
<div class="time" style="width: 7.6923076923077%"></div>
<pre> destruct (IHon om) as [p|q].</pre>
</div>
<div class="code" title="File: Core.v
Line: 109
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Core.v
Line: 110
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply inl, ap, p.</pre>
</div>
<div class="code" title="File: Core.v
Line: 110
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Core.v
Line: 111
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply inr; intro p.</pre>
</div>
<div class="code" title="File: Core.v
Line: 111
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      by apply q, x1_inj.</pre>
</div>
<div class="code" title="File: Core.v
Line: 112
Time: 0.001s">
<div class="time" style="width: 7.6923076923077%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Core.v
Line: 113
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Decidable paths imply Pos is a hSet *)</pre>
</div>
<div class="code" title="File: Core.v
Line: 115
Time: 0.001s">
<div class="time" style="width: 7.6923076923077%"></div>
<pre>Global Instance ishset_pos : IsHSet Pos := _.</pre>
</div>
<div class="code" title="File: Core.v
Line: 115
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** * Operations over positive numbers *)

(** ** Addition *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 120
Time: 0.002s">
<div class="time" style="width: 15.384615384615%"></div>
<pre>Fixpoint pos_add x y :=
  match x, y with
    | p~1, q~1 =&gt; (pos_add_carry p q)~0
    | p~1, q~0 =&gt; (pos_add p q)~1
    | p~1, 1 =&gt; (pos_succ p)~0
    | p~0, q~1 =&gt; (pos_add p q)~1
    | p~0, q~0 =&gt; (pos_add p q)~0
    | p~0, 1 =&gt; p~1
    | 1, q~1 =&gt; (pos_succ q)~0
    | 1, q~0 =&gt; q~1
    | 1, 1 =&gt; 1~0
  end

with pos_add_carry x y :=
  match x, y with
    | p~1, q~1 =&gt; (pos_add_carry p q)~1
    | p~1, q~0 =&gt; (pos_add_carry p q)~0
    | p~1, 1 =&gt; (pos_succ p)~1
    | p~0, q~1 =&gt; (pos_add_carry p q)~0
    | p~0, q~0 =&gt; (pos_add p q)~1
    | p~0, 1 =&gt; (pos_succ p)~0
    | 1, q~1 =&gt; (pos_succ q)~1
    | 1, q~0 =&gt; (pos_succ q)~0
    | 1, 1 =&gt; 1~1
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 144
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Infix "+" := pos_add : positive_scope.</pre>
</div>
<div class="code" title="File: Core.v
Line: 146
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Operation [x -&gt; 2*x-1] *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 149
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Fixpoint pos_pred_double x :=
  match x with
    | p~1 =&gt; p~0~1
    | p~0 =&gt; (pos_pred_double p)~1
    | 1 =&gt; 1
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 154
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Predecessor *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 157
Time: 0.001s">
<div class="time" style="width: 7.6923076923077%"></div>
<pre>Definition pos_pred x :=
  match x with
    | p~1 =&gt; p~0
    | p~0 =&gt; pos_pred_double p
    | 1 =&gt; 1
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 162
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** An auxiliary type for subtraction *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 165
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Inductive Pos_mask : Set :=
  | IsNul : Pos_mask
  | IsPos : Pos -&gt; Pos_mask
  | IsNeg : Pos_mask.</pre>
</div>
<div class="code" title="File: Core.v
Line: 168
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Operation [x -&gt; 2*x+1] *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 171
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition pos_mask_succ_double (x : Pos_mask) : Pos_mask :=
  match x with
    | IsNul =&gt; IsPos 1
    | IsNeg =&gt; IsNeg
    | IsPos p =&gt; IsPos p~1
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 176
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Operation [x -&gt; 2*x] *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 179
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition pos_mask_double (x : Pos_mask) : Pos_mask :=
  match x with
    | IsNul =&gt; IsNul
    | IsNeg =&gt; IsNeg
    | IsPos p =&gt; IsPos p~0
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 184
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Operation [x -&gt; 2*x-2] *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 187
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition pos_mask_double_pred x : Pos_mask :=
  match x with
    | p~1 =&gt; IsPos p~0~0
    | p~0 =&gt; IsPos (pos_pred_double p)~0
    | 1 =&gt; IsNul
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 192
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Predecessor with mask *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 195
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition pos_mask_pred (p : Pos_mask) : Pos_mask :=
  match p with
    | IsPos 1 =&gt; IsNul
    | IsPos q =&gt; IsPos (pos_pred q)
    | IsNul =&gt; IsNeg
    | IsNeg =&gt; IsNeg
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 201
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Subtraction, result as a mask *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 204
Time: 0.001s">
<div class="time" style="width: 7.6923076923077%"></div>
<pre>Fixpoint pos_mask_sub (x y : Pos) {struct y} : Pos_mask :=
  match x, y with
    | p~1, q~1 =&gt; pos_mask_double (pos_mask_sub p q)
    | p~1, q~0 =&gt; pos_mask_succ_double (pos_mask_sub p q)
    | p~1, 1 =&gt; IsPos p~0
    | p~0, q~1 =&gt; pos_mask_succ_double (pos_mask_sub_carry p q)
    | p~0, q~0 =&gt; pos_mask_double (pos_mask_sub p q)
    | p~0, 1 =&gt; IsPos (pos_pred_double p)
    | 1, 1 =&gt; IsNul
    | 1, _ =&gt; IsNeg
  end

with pos_mask_sub_carry (x y : Pos) {struct y} : Pos_mask :=
  match x, y with
    | p~1, q~1 =&gt; pos_mask_succ_double (pos_mask_sub_carry p q)
    | p~1, q~0 =&gt; pos_mask_double (pos_mask_sub p q)
    | p~1, 1 =&gt; IsPos (pos_pred_double p)
    | p~0, q~1 =&gt; pos_mask_double (pos_mask_sub_carry p q)
    | p~0, q~0 =&gt; pos_mask_succ_double (pos_mask_sub_carry p q)
    | p~0, 1 =&gt; pos_mask_double_pred p
    | 1, _ =&gt; IsNeg
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 225
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Subtraction, result as a positive, returning 1 if [x&lt;=y] *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 228
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition pos_sub x y :=
  match pos_mask_sub x y with
    | IsPos z =&gt; z
    | _ =&gt; 1
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 232
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Infix "-" := pos_sub : positive_scope.</pre>
</div>
<div class="code" title="File: Core.v
Line: 234
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Multiplication *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 237
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Fixpoint pos_mul x y :=
  match x with
    | p~1 =&gt; y + (pos_mul p y)~0
    | p~0 =&gt; (pos_mul p y)~0
    | 1 =&gt; y
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 242
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Infix "*" := pos_mul : positive_scope.</pre>
</div>
<div class="code" title="File: Core.v
Line: 244
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Iteration over a positive number *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 247
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition pos_iter {A : Type} (f : A -&gt; A)
  : Pos -&gt; A -&gt; A.</pre>
</div>
<div class="code" title="File: Core.v
Line: 248
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Core.v
Line: 249
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply (pos_peano_ind (fun _ =&gt; A -&gt; A) f).</pre>
</div>
<div class="code" title="File: Core.v
Line: 250
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros n g.</pre>
</div>
<div class="code" title="File: Core.v
Line: 251
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  exact (f o g).</pre>
</div>
<div class="code" title="File: Core.v
Line: 252
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Core.v
Line: 253
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Power *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 256
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition pos_pow (x : Pos) := pos_iter (pos_mul x) 1.</pre>
</div>
<div class="code" title="File: Core.v
Line: 256
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(* We cannot use this notation because it is reserved for path inverse. *)
(* Infix "^" := pos_pow : positive_scope. *)

(** ** Square *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 262
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Fixpoint pos_square p :=
  match p with
    | p~1 =&gt; (pos_square p + p)~0~1
    | p~0 =&gt; (pos_square p)~0~0
    | 1 =&gt; 1
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 267
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Division by 2 rounded below but for 1 *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 270
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition pos_div2 p :=
  match p with
    | 1 =&gt; 1
    | p~0 =&gt; p
    | p~1 =&gt; p
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 275
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Division by 2 rounded up *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 278
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition pos_div2_up p :=
 match p with
   | 1 =&gt; 1
   | p~0 =&gt; p
   | p~1 =&gt; pos_succ p
 end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 283
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Number of digits in a positive number *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 286
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Fixpoint nat_pos_size p : nat :=
  match p with
    | 1 =&gt; S O
    | p~1 =&gt; S (nat_pos_size p)
    | p~0 =&gt; S (nat_pos_size p)
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 291
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Same, with positive output *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 294
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Fixpoint pos_size p :=
  match p with
    | 1 =&gt; 1
    | p~1 =&gt; pos_succ (pos_size p)
    | p~0 =&gt; pos_succ (pos_size p)
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 299
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** From binary positive numbers to Peano natural numbers *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 302
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition pos_iter_op {A} (op : A -&gt; A -&gt; A)
  := fix pos_iter (p : Pos) (a : A) : A
    := match p with
        | 1 =&gt; a
        | p~0 =&gt; pos_iter p (op a a)
        | p~1 =&gt; op a (pos_iter p (op a a))
       end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 308
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** From Peano natural numbers to binary positive numbers *)

(** A version preserving positive numbers, and sending 0 to 1. *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 313
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Fixpoint pos_of_nat (n : nat) : Pos :=
 match n with
   | O =&gt; 1
   | S O =&gt; 1
   | S x =&gt; pos_succ (pos_of_nat x)
 end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 318
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(* Another version that converts [n] into [n+1] *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 321
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Fixpoint pos_of_succ_nat (n : nat) : Pos :=
  match n with
    | O =&gt; 1
    | S x =&gt; pos_succ (pos_of_succ_nat x)
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 325
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Conversion with a decimal representation for printing/parsing *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 328
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Local Notation ten := 1~0~1~0.</pre>
</div>
<div class="code" title="File: Core.v
Line: 328
Time: 0.001s">
<div class="time" style="width: 7.6923076923077%"></div>
<pre>

Fixpoint pos_of_uint_acc (d : Decimal.uint) (acc : Pos) :=
  match d with
  | Decimal.Nil =&gt; acc
  | Decimal.D0 l =&gt; pos_of_uint_acc l (pos_mul ten acc)
  | Decimal.D1 l =&gt; pos_of_uint_acc l (pos_add 1 (pos_mul ten acc))
  | Decimal.D2 l =&gt; pos_of_uint_acc l (pos_add 1~0 (pos_mul ten acc))
  | Decimal.D3 l =&gt; pos_of_uint_acc l (pos_add 1~1 (pos_mul ten acc))
  | Decimal.D4 l =&gt; pos_of_uint_acc l (pos_add 1~0~0 (pos_mul ten acc))
  | Decimal.D5 l =&gt; pos_of_uint_acc l (pos_add 1~0~1 (pos_mul ten acc))
  | Decimal.D6 l =&gt; pos_of_uint_acc l (pos_add 1~1~0 (pos_mul ten acc))
  | Decimal.D7 l =&gt; pos_of_uint_acc l (pos_add 1~1~1 (pos_mul ten acc))
  | Decimal.D8 l =&gt; pos_of_uint_acc l (pos_add 1~0~0~0 (pos_mul ten acc))
  | Decimal.D9 l =&gt; pos_of_uint_acc l (pos_add 1~0~0~1 (pos_mul ten acc))
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 343
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Fixpoint pos_of_uint (d : Decimal.uint) : option Pos :=
  match d with
    | Decimal.Nil =&gt; None
    | Decimal.D0 l =&gt; pos_of_uint l
    | Decimal.D1 l =&gt; Some (pos_of_uint_acc l 1)
    | Decimal.D2 l =&gt; Some (pos_of_uint_acc l 1~0)
    | Decimal.D3 l =&gt; Some (pos_of_uint_acc l 1~1)
    | Decimal.D4 l =&gt; Some (pos_of_uint_acc l 1~0~0)
    | Decimal.D5 l =&gt; Some (pos_of_uint_acc l 1~0~1)
    | Decimal.D6 l =&gt; Some (pos_of_uint_acc l 1~1~0)
    | Decimal.D7 l =&gt; Some (pos_of_uint_acc l 1~1~1)
    | Decimal.D8 l =&gt; Some (pos_of_uint_acc l 1~0~0~0)
    | Decimal.D9 l =&gt; Some (pos_of_uint_acc l 1~0~0~1)
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 358
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition pos_of_decimal_int (d:Decimal.int) : option Pos :=
  match d with
  | Decimal.Pos d =&gt; pos_of_uint d
  | Decimal.Neg _ =&gt; None
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 364
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition pos_of_number_uint (d:Number.int) : option Pos :=
  match d with
  | Number.IntDecimal d =&gt; pos_of_decimal_int d
  | Number.IntHexadecimal _ =&gt; None
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 370
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Fixpoint pos_to_little_uint p :=
  match p with
  | 1 =&gt; Decimal.D1 Decimal.Nil
  | p~1 =&gt; Decimal.Little.succ_double (pos_to_little_uint p)
  | p~0 =&gt; Decimal.Little.double (pos_to_little_uint p)
  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 377
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition pos_to_uint p := Decimal.rev (pos_to_little_uint p).</pre>
</div>
<div class="code" title="File: Core.v
Line: 379
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition pos_to_decimal_int n := Decimal.Pos (pos_to_uint n).</pre>
</div>
<div class="code" title="File: Core.v
Line: 381
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition pos_to_number_uint p := Number.UIntDecimal (pos_to_uint p).</pre>
</div>
<div class="code" title="File: Core.v
Line: 383
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Number Notation Pos pos_of_number_uint pos_to_number_uint : positive_scope.</pre>
</div>
<div class="code" title="File: Core.v
Line: 386
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

</pre>
</div>
</body>
</html>

