<html>
<head>
<title>Finite.v</title>
<style>
.time {
  background-color: #ffaaaa;
  height: 100%;
  z-index: -1;
  position: absolute;
}
.code {
  z-index: 0;
  position: relative;
  border-style: solid;
  border-color: transparent;
  border-width: 1px;
}
.code:hover {
  border-style: solid;
  border-color: black;
  border-width: 1px;
}
pre {
  margin: 1px;
}
</style>
</head>
<body>
<h1>Timings for Finite.v</h1>

<div class="code" title="File: Finite.v
Line: 1
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>(* -*- mode: coq; mode: visual-line -*- *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1
Time: 0.017s">
<div class="time" style="width: 2.7331189710611%"></div>
<pre>Require Import Basics.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1
Time: 0.016s">
<div class="time" style="width: 2.572347266881%"></div>
<pre>
Require Import Types.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 2
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Require Import HSet.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 3
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Require Import HProp.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 4
Time: 0.057s">
<div class="time" style="width: 9.1639871382637%"></div>
<pre>
Require Import DProp.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 5
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
Require Import Spaces.Nat.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 6
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Require Import HFiber.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 7
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Require Import Factorization.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 8
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Require Import Equiv.PathSplit.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 9
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
Require Import Truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 10
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
Require Import Colimits.Quotient.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 11
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Require Import Projective.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 12
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Local Open Scope path_scope.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 14
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Local Open Scope nat_scope.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 15
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** * Finite sets *)

(** ** Canonical finite sets *)

(** A *finite set* is a type that is merely equivalent to the canonical finite set determined by some natural number.  There are many equivalent ways to define the canonical finite sets, such as [{ k : nat &amp; k &lt; n}]; we instead choose a recursive one. *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 22
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Fixpoint Fin (n : nat) : Type
  := match n with
       | 0 =&gt; Empty
       | S n =&gt; Fin n + Unit
     end.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 26
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Fixpoint fin_to_nat {n} : Fin n -&gt; nat
  := match n with
     | 0 =&gt; Empty_rec
     | S n' =&gt;
       fun k =&gt;
         match k with
         | inl k' =&gt; fin_to_nat k'
         | inr tt =&gt; n'
         end
     end.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 37
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Global Instance decidable_fin (n : nat)
: Decidable (Fin n).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 40
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 41
Time: 0.018s">
<div class="time" style="width: 2.8938906752412%"></div>
<pre>
  destruct n as [|n]; try exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 42
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  exact (inl (inr tt)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 43
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 44
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Global Instance decidablepaths_fin (n : nat)
: DecidablePaths (Fin n).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 47
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 48
Time: 0.024s">
<div class="time" style="width: 3.8585209003215%"></div>
<pre>
  induction n as [|n IHn]; simpl; exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 49
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 50
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Global Instance contr_fin1 : Contr (Fin 1).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 52
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 53
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (contr_equiv' Unit (sum_empty_l Unit)^-1).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 54
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 55
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition fin_empty (n : nat) (f : Fin n -&gt; Empty) : n = 0.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 57
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 58
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  destruct n; [ reflexivity | ].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 59
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  elim (f (inr tt)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 60
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 61
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** The zeroth element of a non-empty finite set is the left most element. It also happens to be the biggest by termsize. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 63
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>Fixpoint fin_zero {n : nat} : Fin n.+1 :=
  match n with
  | O =&gt; inr tt
  | S _ =&gt; inl fin_zero
  end.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 67
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Where `fin_zero` computes the first element of Fin (S n), `fin_last` computes the last. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 69
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition fin_last {n : nat} : Fin (S n) := inr tt.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 69
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Injection Fin n -&gt; Fin n.+1 mapping the kth element to the kth element. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 71
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition fin_incl {n : nat} (k : Fin n) : Fin (S n) := inl k.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 71
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** There is an injection from Fin n -&gt; Fin n.+1 that maps the kth element to the (k+1)th element. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 73
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>Fixpoint fsucc {n : nat} : Fin n -&gt; Fin n.+1 :=
  match n with
  | O =&gt; Empty_rec
  | S n' =&gt;
    fun i : Fin (S n') =&gt;
      match i with
      | inl i' =&gt; inl (fsucc i')
      | inr tt =&gt; inr tt
      end
  end.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 82
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** This injection is an injection/embedding *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 84
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Lemma isembedding_fsucc {n : nat} : IsEmbedding (@fsucc n).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 84
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 85
Time: 0.018s">
<div class="time" style="width: 2.8938906752412%"></div>
<pre>
  apply isembedding_isinj_hset.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 86
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 87
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 88
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intro i.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 88
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> elim i.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 88
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 89
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> intros [] []; intro p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 89
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 90
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> f_ap.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 90
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply IHn.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 90
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> eapply path_sum_inl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 90
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 90
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 91
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> destruct u.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 91
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> elim (inl_ne_inr _ _ p).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 91
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 92
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> destruct u.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 92
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> elim (inr_ne_inl _ _ p).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 92
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 93
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> destruct u, u0; reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 93
Time: 0.005s">
<div class="time" style="width: 0.80385852090032%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 94
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Lemma path_fin_fsucc_incl {n : nat} : forall k : Fin n, fsucc (fin_incl k) = fin_incl (fsucc k).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 96
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 97
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  trivial.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 98
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 99
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Lemma path_nat_fin_incl {n : nat} : forall k : Fin n, fin_to_nat (fin_incl k) = fin_to_nat k.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 101
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 102
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 103
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 104
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Lemma path_nat_fsucc {n : nat} : forall k : Fin n, fin_to_nat (fsucc k) = S (fin_to_nat k).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 106
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 107
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n' IHn].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 108
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 109
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros [].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 109
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 110
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> intros [k'|[]].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 110
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 111
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> rewrite path_fin_fsucc_incl, path_nat_fin_incl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 111
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply IHn.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 112
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 113
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 113
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 114
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Lemma path_nat_fin_zero {n} : fin_to_nat (@fin_zero n) = 0.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 116
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 117
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n' IHn].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 118
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 119
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 119
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 120
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> trivial.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 120
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 121
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Lemma path_nat_fin_last {n} : fin_to_nat (@fin_last n) = n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 123
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 124
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 125
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 126
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Transposition equivalences *)

(** To prove some basic facts about canonical finite sets, we need some standard automorphisms of them.  Here we define some transpositions and prove that they in fact do the desired things. *)

(** *** Swap the last two elements. *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 133
Time: 0.003s">
<div class="time" style="width: 0.48231511254019%"></div>
<pre>Definition fin_transpose_last_two (n : nat)
: Fin n.+2 &lt;~&gt; Fin n.+2
  := ((equiv_sum_assoc _ _ _)^-1)
       oE (1 +E (equiv_sum_symm _ _))
       oE (equiv_sum_assoc _ _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 137
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Arguments fin_transpose_last_two : simpl nomatch.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 139
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>

Definition fin_transpose_last_two_last (n : nat)
: fin_transpose_last_two n (inr tt) = (inl (inr tt))
  := 1.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 143
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>

Definition fin_transpose_last_two_nextlast (n : nat)
: fin_transpose_last_two n (inl (inr tt)) = (inr tt)
  := 1.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 147
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>

Definition fin_transpose_last_two_rest (n : nat) (k : Fin n)
: fin_transpose_last_two n (inl (inl k)) = (inl (inl k))
  := 1.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 151
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** *** Swap the last element with [k]. *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 154
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Fixpoint fin_transpose_last_with (n : nat) (k : Fin n.+1)
: Fin n.+1 &lt;~&gt; Fin n.+1.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 155
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 156
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  destruct k as [k|].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 157
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 158
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> destruct n as [|n].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 158
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 159
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> elim k.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 159
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 160
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> destruct k as [k|].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 160
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 161
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine ((fin_transpose_last_two n)
                  oE _
                  oE (fin_transpose_last_two n)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 163
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        refine ((fin_transpose_last_with n (inl k)) +E 1).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 164
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 165
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply fin_transpose_last_two.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 165
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 166
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (equiv_idmap _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 166
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 167
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Arguments fin_transpose_last_with : simpl nomatch.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 169
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition fin_transpose_last_with_last (n : nat) (k : Fin n.+1)
: fin_transpose_last_with n k (inr tt) = k.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 172
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 173
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  destruct k as [k|].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 174
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 175
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre> induction n as [|n IH]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 175
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 176
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> elim k.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 176
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 177
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> destruct k as [k|].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 177
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 178
Time: 0.276s">
<div class="time" style="width: 44.372990353698%"></div>
<pre> simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 178
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre> rewrite IH; reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 178
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 179
Time: 0.037s">
<div class="time" style="width: 5.9485530546624%"></div>
<pre> simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 179
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> apply ap, ap, path_contr.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 179
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 180
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> (** We have to destruct [n] since fixpoints don't reduce unless their argument is a constructor. *)
   </pre>
</div>
<div class="code" title="File: Finite.v
Line: 181
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>destruct n; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 181
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    all:apply ap, path_contr.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 182
Time: 0.004s">
<div class="time" style="width: 0.64308681672026%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 183
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition fin_transpose_last_with_with (n : nat) (k : Fin n.+1)
: fin_transpose_last_with n k k = inr tt.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 186
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 187
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  destruct k as [k|].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 188
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 189
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> induction n as [|n IH]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 189
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 190
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> elim k.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 190
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 191
Time: 0.267s">
<div class="time" style="width: 42.926045016077%"></div>
<pre> destruct k as [|k]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 191
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 192
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre> rewrite IH; reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 192
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 193
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply ap, path_contr.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 193
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 194
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> destruct n; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 194
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    all:apply ap, path_contr.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 195
Time: 0.004s">
<div class="time" style="width: 0.64308681672026%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 196
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition fin_transpose_last_with_rest (n : nat)
           (k : Fin n.+1) (l : Fin n)
           (notk : k &lt;&gt; inl l)
: fin_transpose_last_with n k (inl l) = (inl l).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 201
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 202
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  destruct k as [k|].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 203
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 204
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre> induction n as [|n IH]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 204
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    1:elim k.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 205
Time: 0.622s">
<div class="time" style="width: 100%"></div>
<pre>
    destruct k as [k|]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 206
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 207
Time: 0.005s">
<div class="time" style="width: 0.80385852090032%"></div>
<pre> destruct l as [l|]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 207
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 208
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre> rewrite IH.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 208
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 209
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 209
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 210
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (fun p =&gt; notk (ap inl p)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 210
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 211
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 211
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 211
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 212
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre> destruct l as [l|]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 212
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 213
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 213
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 214
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> elim (notk (ap inl (ap inr (path_unit _ _)))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 214
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 214
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 215
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> destruct n; reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 215
Time: 0.015s">
<div class="time" style="width: 2.411575562701%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 216
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition fin_transpose_last_with_last_other (n : nat) (k : Fin n.+1)
: fin_transpose_last_with n (inr tt) k = k.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 219
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 220
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  destruct n; reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 221
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 222
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition fin_transpose_last_with_invol (n : nat) (k : Fin n.+1)
: fin_transpose_last_with n k o fin_transpose_last_with n k == idmap.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 225
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 226
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros l.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 227
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  destruct l as [l|[]].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 228
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 229
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> destruct k as [k|[]].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 229
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 230
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> destruct (dec_paths k l) as [p|p].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 230
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 231
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> rewrite p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 231
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        rewrite fin_transpose_last_with_with.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 232
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply fin_transpose_last_with_last.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 233
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 234
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> rewrite fin_transpose_last_with_rest;
          try apply fin_transpose_last_with_rest;
          exact (fun q =&gt; p (path_sum_inl _ q)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 236
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 236
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 237
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> rewrite fin_transpose_last_with_last_other.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 237
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply fin_transpose_last_with_last_other.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 238
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 239
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> rewrite fin_transpose_last_with_last.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 239
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply fin_transpose_last_with_with.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 240
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 241
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Equivalences between canonical finite sets *)

(** To give an equivalence [Fin n.+1 &lt;~&gt; Fin m.+1] is equivalent to giving an element of [Fin m.+1] (the image of the last element) together with an equivalence [Fin n &lt;~&gt; Fin m].  More specifically, any such equivalence can be decomposed uniquely as a last-element transposition followed by an equivalence fixing the last element.  *)

(** Here is the uncurried map that constructs an equivalence [Fin n.+1 &lt;~&gt; Fin m.+1]. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 247
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>Definition fin_equiv (n m : nat)
           (k : Fin m.+1) (e : Fin n &lt;~&gt; Fin m)
: Fin n.+1 &lt;~&gt; Fin m.+1
  := (fin_transpose_last_with m k)
       oE (e +E 1).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 251
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Here is the curried version that we will prove to be an equivalence. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 253
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition fin_equiv' (n m : nat)
: ((Fin m.+1) * (Fin n &lt;~&gt; Fin m)) -&gt; (Fin n.+1 &lt;~&gt; Fin m.+1)
  := fun ke =&gt; fin_equiv n m (fst ke) (snd ke).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 255
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** We construct its inverse and the two homotopies first as versions using homotopies without funext (similar to [ExtendableAlong]), then apply funext at the end. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 257
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>Definition fin_equiv_hfiber (n m : nat) (e : Fin n.+1 &lt;~&gt; Fin m.+1)
: { kf : (Fin m.+1) * (Fin n &lt;~&gt; Fin m) &amp; fin_equiv' n m kf == e }.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 258
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 259
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  simpl in e.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 260
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (equiv_sigma_prod _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 261
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  recall (e (inr tt)) as y eqn:p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 262
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
  assert (p' := (moveL_equiv_V _ _ p)^).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 263
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  exists y.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 264
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
  destruct y as [y|[]].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 265
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 266
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> simple refine (equiv_unfunctor_sum_l
              (fin_transpose_last_with m (inl y) oE e)
              _ _ ; _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 268
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 269
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros a.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 269
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> ev_equiv.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 269
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
      assert (q : inl y &lt;&gt; e (inl a))
        by exact (fun z =&gt; inl_ne_inr _ _ (equiv_inj e (z^ @ p^))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 271
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      set (z := e (inl a)) in *.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 272
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
      destruct z as [z|[]].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 273
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 274
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> rewrite fin_transpose_last_with_rest;
        try exact tt; try assumption.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 275
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 276
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> rewrite fin_transpose_last_with_last; exact tt.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 276
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 276
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 277
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros [].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 277
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> ev_equiv.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 277
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      rewrite p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 278
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      rewrite fin_transpose_last_with_with; exact tt.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 279
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 279
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros x.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 280
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> unfold fst, snd; ev_equiv.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 280
Time: 0.073s">
<div class="time" style="width: 11.736334405145%"></div>
<pre> simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 280
Time: 0.031s">
<div class="time" style="width: 4.983922829582%"></div>
<pre>
    destruct x as [x|[]]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 281
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 282
Time: 0.004s">
<div class="time" style="width: 0.64308681672026%"></div>
<pre> rewrite unfunctor_sum_l_beta.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 282
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply fin_transpose_last_with_invol.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 283
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 284
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine (fin_transpose_last_with_last _ _ @ p^).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 284
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 285
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> simple refine (equiv_unfunctor_sum_l e _ _ ; _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 285
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 286
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros a.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 286
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
      destruct (is_inl_or_is_inr (e (inl a))) as [l|r].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 287
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 288
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact l.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 288
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 289
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> assert (q := inr_un_inr (e (inl a)) r).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 289
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
        apply moveR_equiv_V in q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 290
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
        assert (s := q^ @ ap (e^-1 o inr) (path_unit _ _) @ p').</pre>
</div>
<div class="code" title="File: Finite.v
Line: 291
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        elim (inl_ne_inr _ _ s).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 292
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 292
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 293
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros []; exact (p^ # tt).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 293
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 293
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros x.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 294
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> unfold fst, snd; ev_equiv.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 294
Time: 0.005s">
<div class="time" style="width: 0.80385852090032%"></div>
<pre> simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 294
Time: 0.005s">
<div class="time" style="width: 0.80385852090032%"></div>
<pre>
    destruct x as [a|[]].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 295
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 296
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre> rewrite fin_transpose_last_with_last_other.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 296
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply unfunctor_sum_l_beta.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 297
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 298
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 298
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      rewrite fin_transpose_last_with_last.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 299
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      symmetry; apply p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 300
Time: 0.046s">
<div class="time" style="width: 7.395498392283%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 301
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition fin_equiv_inv (n m : nat) (e : Fin n.+1 &lt;~&gt; Fin m.+1)
: (Fin m.+1) * (Fin n &lt;~&gt; Fin m)
  := (fin_equiv_hfiber n m e).1.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 305
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>

Definition fin_equiv_issect (n m : nat) (e : Fin n.+1 &lt;~&gt; Fin m.+1)
: fin_equiv' n m (fin_equiv_inv n m e) == e
  := (fin_equiv_hfiber n m e).2.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 309
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition fin_equiv_inj_fst (n m : nat)
           (k l : Fin m.+1) (e f : Fin n &lt;~&gt; Fin m)
: (fin_equiv n m k e == fin_equiv n m l f) -&gt; (k = l).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 313
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 314
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 315
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
  refine (_ @ p (inr tt) @ _); simpl;
  rewrite fin_transpose_last_with_last; reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 317
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 318
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>

Definition fin_equiv_inj_snd (n m : nat)
           (k l : Fin m.+1) (e f : Fin n &lt;~&gt; Fin m)
: (fin_equiv n m k e == fin_equiv n m l f) -&gt; (e == f).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 322
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 323
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 324
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros x.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 325
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> assert (q := p (inr tt)); simpl in q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 325
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
  rewrite !fin_transpose_last_with_last in q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 326
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  rewrite &lt;- q in p; clear q l.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 327
Time: 0.006s">
<div class="time" style="width: 0.96463022508039%"></div>
<pre>
  exact (path_sum_inl _
           (equiv_inj (fin_transpose_last_with m k) (p (inl x)))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 329
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 330
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Now it's time for funext. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 332
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance isequiv_fin_equiv `{Funext} (n m : nat)
: IsEquiv (fin_equiv' n m).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 333
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 334
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (isequiv_pathsplit 0 _); split.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 335
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 336
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros e; exists (fin_equiv_inv n m e).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 336
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply path_equiv, path_arrow, fin_equiv_issect.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 337
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 338
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> intros [k e] [l f]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 338
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    refine (_ , fun _ _ =&gt; tt).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 339
Time: 0.023s">
<div class="time" style="width: 3.6977491961415%"></div>
<pre>
    intros p; refine (_ ; path_ishprop _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 340
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply (ap equiv_fun) in p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 341
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply ap10 in p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 342
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply path_prod'.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 343
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 344
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine (fin_equiv_inj_fst n m k l e f p).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 344
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 345
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply path_equiv, path_arrow.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 345
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (fin_equiv_inj_snd n m k l e f p).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 346
Time: 0.007s">
<div class="time" style="width: 1.1254019292605%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 347
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>

Definition equiv_fin_equiv `{Funext} (n m : nat)
: ((Fin m.+1) * (Fin n &lt;~&gt; Fin m)) &lt;~&gt; (Fin n.+1 &lt;~&gt; Fin m.+1)
  := Build_Equiv _ _ (fin_equiv' n m) _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 351
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** In particular, this implies that if two canonical finite sets are equivalent, then their cardinalities are equal. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 353
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition nat_eq_fin_equiv (n m : nat)
: (Fin n &lt;~&gt; Fin m) -&gt; (n = m).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 354
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 355
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  revert m; induction n as [|n IHn]; induction m as [|m IHm]; intros e.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 356
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 357
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact idpath.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 357
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 358
Time: 0.004s">
<div class="time" style="width: 0.64308681672026%"></div>
<pre> elim (e^-1 (inr tt)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 358
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 359
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> elim (e (inr tt)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 359
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 360
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine (ap S (IHn m _)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 360
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (snd (fin_equiv_inv n m e)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 361
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 362
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Definition of general finite sets *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 365
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>Class Finite (X : Type) :=
  { fcard : nat ;
    merely_equiv_fin : merely (X &lt;~&gt; Fin fcard) }.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 367
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Arguments fcard X {_}.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 369
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Arguments merely_equiv_fin X {_}.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 370
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition issig_finite X
: { n : nat &amp; merely (X &lt;~&gt; Fin n) } &lt;~&gt; Finite X.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 373
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 374
Time: 0.007s">
<div class="time" style="width: 1.1254019292605%"></div>
<pre>
  issig.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 375
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 376
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Note that the sigma over cardinalities is not truncated.  Nevertheless, because canonical finite sets of different cardinalities are not isomorphic, being finite is still an hprop.  (Thus, we could have truncated the sigma and gotten an equivalent definition, but it would be less convenient to reason about.) *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 378
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance ishprop_finite X
: IsHProp (Finite X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 379
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 380
Time: 0.022s">
<div class="time" style="width: 3.5369774919614%"></div>
<pre>
  refine (trunc_equiv' _ (issig_finite X)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 381
Time: 0.003s">
<div class="time" style="width: 0.48231511254019%"></div>
<pre>
  apply ishprop_sigma_disjoint; intros n m Hn Hm.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 382
Time: 0.037s">
<div class="time" style="width: 5.9485530546624%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 383
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (nat_eq_fin_equiv n m (Hm oE Hn^-1)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 384
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 385
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Preservation of finiteness by equivalences *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 388
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition finite_equiv X {Y} (e : X -&gt; Y) `{IsEquiv X Y e}
: Finite X -&gt; Finite Y.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 389
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 390
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros ?.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 391
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (Build_Finite Y (fcard X) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 392
Time: 0.018s">
<div class="time" style="width: 2.8938906752412%"></div>
<pre>
  assert (f := merely_equiv_fin X); strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 393
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply tr.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 394
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
  exact (equiv_compose f e^-1).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 395
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 396
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>

Definition finite_equiv' X {Y} (e : X &lt;~&gt; Y)
: Finite X -&gt; Finite Y
  := finite_equiv X e.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 400
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Corollary finite_equiv_equiv X Y
: (X &lt;~&gt; Y) -&gt; (Finite X &lt;~&gt; Finite Y).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 403
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 404
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
  intros ?; apply equiv_iff_hprop; apply finite_equiv';
    [ assumption | symmetry; assumption ].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 406
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 407
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition fcard_equiv {X Y} (e : X -&gt; Y) `{IsEquiv X Y e}
           `{Finite X} `{Finite Y}
: fcard X = fcard Y.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 411
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 412
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  transitivity (@fcard Y (finite_equiv X e _)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 413
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 414
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 414
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 415
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (ap (@fcard Y) (path_ishprop _ _)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 415
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 416
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>

Definition fcard_equiv' {X Y} (e : X &lt;~&gt; Y)
           `{Finite X} `{Finite Y}
: fcard X = fcard Y
  := fcard_equiv e.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 421
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Simple examples of finite sets *)

(** Canonical finite sets are finite *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 425
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance finite_fin n : Finite (Fin n)
  := Build_Finite _ n (tr (equiv_idmap _)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 426
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** This includes the empty set. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 428
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance finite_empty : Finite Empty
  := finite_fin 0.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 429
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** The unit type is finite, since it's equivalent to [Fin 1]. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 431
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance finite_unit : Finite Unit.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 431
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 432
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (finite_equiv' (Fin 1) _ _); simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 433
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply sum_empty_l.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 434
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 435
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Thus, any contractible type is finite. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 437
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>Global Instance finite_contr X `{Contr X} : Finite X
  := finite_equiv Unit equiv_contr_unit^-1 _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 438
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Any decidable hprop is finite, since it must be equivalent to [Empty] or [Unit]. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 440
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition finite_decidable_hprop X `{IsHProp X} `{Decidable X}
: Finite X.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 441
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 442
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  destruct (dec X) as [x|nx].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 443
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 444
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> assert (Contr X) by exact (contr_inhabited_hprop X x).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 444
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
    exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 445
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 446
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> refine (finite_equiv Empty nx^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 446
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 447
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

#[export]
Hint Immediate finite_decidable_hprop : typeclass_instances.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 450
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** It follows that the propositional truncation of any finite set is finite. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 452
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance finite_merely X {fX : Finite X}
: Finite (merely X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 453
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 454
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** As in decidable_finite_hprop, we case on cardinality first to avoid needing funext. *)
 </pre>
</div>
<div class="code" title="File: Finite.v
Line: 456
Time: 0.054s">
<div class="time" style="width: 8.6816720257235%"></div>
<pre>destruct fX as [[|n] e]; refine (finite_decidable_hprop _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 456
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 457
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> right.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 457
Time: 0.025s">
<div class="time" style="width: 4.0192926045016%"></div>
<pre>
    intros x; strip_truncations; exact (e x).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 458
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 459
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> left.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 459
Time: 0.012s">
<div class="time" style="width: 1.9292604501608%"></div>
<pre>
    strip_truncations; exact (tr (e^-1 (inr tt))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 460
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 461
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Finite sets are closed under path-spaces. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 463
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance finite_paths {X} `{Finite X} (x y : X)
: Finite (x = y).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 464
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 465
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** If we assume [Funext], then typeclass inference produces this automatically, since [X] has decidable equality and (hence) is a set, so [x=y] is a decidable hprop.  But we can also deduce it without funext, since [Finite] is an hprop even without funext. *)
 </pre>
</div>
<div class="code" title="File: Finite.v
Line: 467
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 467
Time: 0.029s">
<div class="time" style="width: 4.6623794212219%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 468
Time: 0.064s">
<div class="time" style="width: 10.289389067524%"></div>
<pre>
  refine (finite_equiv _ (ap e)^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 469
Time: 0.031s">
<div class="time" style="width: 4.983922829582%"></div>
<pre>
  apply finite_decidable_hprop; exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 470
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 471
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Finite sets are also closed under successors. *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 474
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance finite_succ X `{Finite X} : Finite (X + Unit).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 474
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 475
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (Build_Finite _ (fcard X).+1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 476
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  pose proof (merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 477
Time: 0.01s">
<div class="time" style="width: 1.6077170418006%"></div>
<pre>
  strip_truncations; apply tr.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 478
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (_ +E 1); assumption.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 479
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 480
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>

Definition fcard_succ X `{Finite X}
: fcard (X + Unit) = (fcard X).+1
  := 1.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 484
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Decidability *)

(** Like canonical finite sets, finite sets have decidable equality. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 488
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance decidablepaths_finite `{Funext} X `{Finite X}
: DecidablePaths X.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 489
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 490
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 491
Time: 0.018s">
<div class="time" style="width: 2.8938906752412%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 492
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
  refine (decidablepaths_equiv _ e^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 493
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 494
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** However, contrary to what you might expect, we cannot assert that "every finite set is decidable"!  That would be claiming a *uniform* way to select an element from every nonempty finite set, which contradicts univalence. *)

(** One thing we can prove is that any finite hprop is decidable. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 498
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance decidable_finite_hprop X `{IsHProp X} {fX : Finite X}
: Decidable X.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 499
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 500
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** To avoid having to use [Funext], we case on the cardinality of [X] before stripping the truncation from its equivalence to [Fin n]; if we did things in the other order then we'd have to know that [Decidable X] is an hprop, which requires funext. *)
 </pre>
</div>
<div class="code" title="File: Finite.v
Line: 502
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>destruct fX as [[|n] e].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 502
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 503
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> right; intros x.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 503
Time: 0.033s">
<div class="time" style="width: 5.3054662379421%"></div>
<pre>
    strip_truncations; exact (e x).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 504
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 505
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> left.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 505
Time: 0.02s">
<div class="time" style="width: 3.2154340836013%"></div>
<pre>
    strip_truncations; exact (e^-1 (inr tt)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 506
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 507
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** It follows that if [X] is finite, then its propositional truncation is decidable. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 509
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance decidable_merely_finite X {fX : Finite X}
: Decidable (merely X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 510
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 511
Time: 0.018s">
<div class="time" style="width: 2.8938906752412%"></div>
<pre>
  exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 512
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 513
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** From this, it follows that any finite set is *merely* decidable. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 515
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition merely_decidable_finite X `{Finite X}
: merely (Decidable X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 516
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 517
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
  apply O_decidable; exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 518
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 519
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Induction over finite sets *)

(** Most concrete applications of this don't actually require univalence, but the general version does.  For this reason the general statement is less useful (and less used in the sequel) than it might be. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 523
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>Definition finite_ind_hprop `{Univalence}
           (P : forall X, Finite X -&gt; Type)
           `{forall X (fX:Finite X), IsHProp (P X _)}
           (f0 : P Empty _)
           (fs : forall X (fX:Finite X), P X _ -&gt; P (X + Unit)%type _)
           (X : Type) `{Finite X}
: P X _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 529
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 530
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 531
Time: 0.04s">
<div class="time" style="width: 6.4308681672026%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 532
Time: 0.003s">
<div class="time" style="width: 0.48231511254019%"></div>
<pre>
  assert (p := transportD Finite P (path_universe e^-1) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 533
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (transport (P X) (path_ishprop _ _) (p _)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 534
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize (fcard X); intros n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 535
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 536
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 537
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact f0.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 537
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 538
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine (transport (P (Fin n.+1)) (path_ishprop _ _) (fs _ _ IH)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 538
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 539
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** The finite axiom of choice, and projectivity *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 542
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition finite_choice {X} `{Finite X} (P : X -&gt; Type)
  : (forall x, merely (P x)) -&gt; merely (forall x, P x).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 543
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 544
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros f.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 545
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 546
Time: 0.021s">
<div class="time" style="width: 3.3762057877814%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 547
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
  set (P' := P o e^-1).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 548
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (f' := (fun x =&gt; f (e^-1 x)) : forall x, merely (P' x)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 549
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (Trunc_functor (X := forall x:Fin (fcard X), P' x) (-1) _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 550
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 551
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros g x; exact (eissect e x # g (e x)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 551
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 552
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> clearbody P'; clear f P e.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 552
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    generalize dependent (fcard X); intros n P f.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 553
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 554
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 555
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (tr (Empty_ind P)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 555
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 556
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> specialize (IH (P o inl) (f o inl)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 556
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      assert (e := f (inr tt)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 557
Time: 0.049s">
<div class="time" style="width: 7.8778135048232%"></div>
<pre>
      strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 558
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (tr (sum_ind P IH (Unit_ind e))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 559
Time: 0.004s">
<div class="time" style="width: 0.64308681672026%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 560
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Corollary isprojective_fin_n (n : nat) : IsProjective (Fin n).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 562
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 563
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply (iff_isprojective_choice (Fin n)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 564
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  rapply finite_choice.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 565
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 566
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Constructions on finite sets *)

(** Finite sets are closed under sums, products, function spaces, and equivalence spaces.  There are multiple choices we could make regarding how to prove these facts.  Since we know what the cardinalities ought to be in all cases (since we know how to add, multiply, exponentiate, and take factorials of natural numbers), we could specify those off the bat, and then reduce to the case of canonical finite sets.  However, it's more amusing to instead prove finiteness of these constructions by "finite-set induction", and then *deduce* that their cardinalities are given by the corresponding operations on natural numbers (because they satisfy the same recurrences). *)

(** *** Binary sums *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 573
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance finite_sum X Y `{Finite X} `{Finite Y}
: Finite (X + Y).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 574
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 575
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin Y).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 576
Time: 0.017s">
<div class="time" style="width: 2.7331189710611%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 577
Time: 0.014s">
<div class="time" style="width: 2.2508038585209%"></div>
<pre>
  refine (finite_equiv _ (functor_sum idmap e^-1) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 578
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize (fcard Y); intros n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 579
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 580
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 581
Time: 0.003s">
<div class="time" style="width: 0.48231511254019%"></div>
<pre> refine (finite_equiv _ (sum_empty_r X)^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 581
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 582
Time: 0.003s">
<div class="time" style="width: 0.48231511254019%"></div>
<pre> refine (finite_equiv _ (equiv_sum_assoc X _ Unit) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 582
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 583
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Note that the cardinality function [fcard] actually computes.  The same will be true of all the other proofs in this section, though we don't always verify it. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 585
Time: 0.004s">
<div class="time" style="width: 0.64308681672026%"></div>
<pre>Goal fcard (Fin 3 + Fin 4) = 7.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 585
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 586
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Abort.

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 588
Time: 0.004s">
<div class="time" style="width: 0.64308681672026%"></div>
<pre>Definition fcard_sum X Y `{Finite X} `{Finite Y}
: fcard (X + Y) = (fcard X + fcard Y).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 589
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 590
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (_ @ nat_plus_comm _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 591
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin Y).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 592
Time: 0.023s">
<div class="time" style="width: 3.6977491961415%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 593
Time: 0.005s">
<div class="time" style="width: 0.80385852090032%"></div>
<pre>
  refine (fcard_equiv' (1 +E e) @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 594
Time: 0.004s">
<div class="time" style="width: 0.64308681672026%"></div>
<pre>
  refine (_ @ ap (fun y =&gt; (y + fcard X)) (fcard_equiv e^-1)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 595
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize (fcard Y); intros n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 596
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 597
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 598
Time: 0.009s">
<div class="time" style="width: 1.4469453376206%"></div>
<pre> refine (fcard_equiv (sum_empty_r X)^-1).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 598
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 599
Time: 0.022s">
<div class="time" style="width: 3.5369774919614%"></div>
<pre> refine (fcard_equiv (equiv_sum_assoc _ _ _)^-1 @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 599
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (ap S IH).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 600
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 601
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** *** Binary products *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 604
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance finite_prod X Y `{Finite X} `{Finite Y}
: Finite (X * Y).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 605
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 606
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin Y).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 607
Time: 0.018s">
<div class="time" style="width: 2.8938906752412%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 608
Time: 0.018s">
<div class="time" style="width: 2.8938906752412%"></div>
<pre>
  refine (finite_equiv _ (functor_prod idmap e^-1) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 609
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize (fcard Y); intros n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 610
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 611
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 612
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> refine (finite_equiv _ (prod_empty_r X)^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 612
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 613
Time: 0.011s">
<div class="time" style="width: 1.7684887459807%"></div>
<pre> refine (finite_equiv _ (sum_distrib_l X _ Unit)^-1 (finite_sum _ _)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 613
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
    refine (finite_equiv _ (prod_unit_r X)^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 614
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 615
Time: 0.007s">
<div class="time" style="width: 1.1254019292605%"></div>
<pre>

Definition fcard_prod X Y `{Finite X} `{Finite Y}
: fcard (X * Y) = fcard X * fcard Y.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 618
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 619
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 620
Time: 0.024s">
<div class="time" style="width: 3.8585209003215%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 621
Time: 0.011s">
<div class="time" style="width: 1.7684887459807%"></div>
<pre>
  refine (fcard_equiv' (e *E 1) @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 622
Time: 0.003s">
<div class="time" style="width: 0.48231511254019%"></div>
<pre>
  refine (_ @ ap (fun x =&gt; x * fcard Y) (fcard_equiv e^-1)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 623
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize (fcard X); intros n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 624
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 625
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 626
Time: 0.009s">
<div class="time" style="width: 1.4469453376206%"></div>
<pre> refine (fcard_equiv (prod_empty_l Y)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 626
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 627
Time: 0.029s">
<div class="time" style="width: 4.6623794212219%"></div>
<pre> refine (fcard_equiv (sum_distrib_r Y (Fin n) Unit) @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 627
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    refine (fcard_sum _ _ @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 628
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 629
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    refine (_ @ nat_plus_comm _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 630
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    refine (ap011 plus _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 631
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 632
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply IH.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 632
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 633
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply fcard_equiv', prod_unit_l.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 633
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 634
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** *** Function types *)

(** Finite sets are closed under function types, and even dependent function types. *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 639
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance finite_forall `{Funext} {X} (Y : X -&gt; Type)
       `{Finite X} `{forall x, Finite (Y x)}
: Finite (forall x:X, Y x).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 641
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 642
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 643
Time: 0.023s">
<div class="time" style="width: 3.6977491961415%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 644
Time: 0.061s">
<div class="time" style="width: 9.8070739549839%"></div>
<pre>
  simple refine (finite_equiv' _
            (equiv_functor_forall' (P := fun x =&gt; Y (e^-1 x)) e _) _); try exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 646
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 647
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros x; refine (equiv_transport _ _ _ (eissect e x)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 647
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 647
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
  set (Y' := Y o e^-1); change (Finite (forall x, Y' x)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 648
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
  assert (forall x, Finite (Y' x)) by exact _; clearbody Y'; clear e.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 649
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize dependent (fcard X); intros n Y' ?.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 650
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 651
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 652
Time: 0.003s">
<div class="time" style="width: 0.48231511254019%"></div>
<pre> exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 652
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 653
Time: 0.033s">
<div class="time" style="width: 5.3054662379421%"></div>
<pre> refine (finite_equiv _ (equiv_sum_ind Y') _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 653
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply finite_prod.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 654
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 655
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply IH; exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 655
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 656
Time: 0.013s">
<div class="time" style="width: 2.0900321543408%"></div>
<pre> refine (finite_equiv _ (@Unit_ind (fun u =&gt; Y' (inr u))) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 656
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (isequiv_unit_ind (Y' o inr)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 657
Time: 0.003s">
<div class="time" style="width: 0.48231511254019%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 658
Time: 0.012s">
<div class="time" style="width: 1.9292604501608%"></div>
<pre>

Definition fcard_arrow `{Funext} X Y `{Finite X} `{Finite Y}
: fcard (X -&gt; Y) = nat_exp (fcard Y) (fcard X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 661
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 662
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 663
Time: 0.031s">
<div class="time" style="width: 4.983922829582%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 664
Time: 0.031s">
<div class="time" style="width: 4.983922829582%"></div>
<pre>
  refine (fcard_equiv (functor_arrow e idmap)^-1 @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 665
Time: 0.003s">
<div class="time" style="width: 0.48231511254019%"></div>
<pre>
  refine (_ @ ap (fun x =&gt; nat_exp (fcard Y) x) (fcard_equiv e)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 666
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize (fcard X); intros n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 667
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 668
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 669
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 669
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 670
Time: 0.062s">
<div class="time" style="width: 9.967845659164%"></div>
<pre> refine (fcard_equiv (equiv_sum_ind (fun (_:Fin n.+1) =&gt; Y))^-1 @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 670
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
    refine (fcard_prod _ _ @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 671
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply (ap011 mult).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 672
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 673
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> assumption.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 673
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 674
Time: 0.008s">
<div class="time" style="width: 1.2861736334405%"></div>
<pre> refine (fcard_equiv (@Unit_ind (fun (_:Unit) =&gt; Y))^-1).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 674
Time: 0.006s">
<div class="time" style="width: 0.96463022508039%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 675
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** [fcard] still computes, despite the funext: *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 677
Time: 0.021s">
<div class="time" style="width: 3.3762057877814%"></div>
<pre>Goal forall fs:Funext, fcard (Fin 3 -&gt; Fin 4) = 64.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 677
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
  reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 678
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Abort.

(** *** Automorphism types (i.e. symmetric groups) *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 682
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance finite_aut `{Funext} X `{Finite X}
: Finite (X &lt;~&gt; X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 683
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 684
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 685
Time: 0.017s">
<div class="time" style="width: 2.7331189710611%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 686
Time: 0.021s">
<div class="time" style="width: 3.3762057877814%"></div>
<pre>
  refine (finite_equiv _
            (equiv_functor_equiv e^-1 e^-1) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 688
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize (fcard X); intros n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 689
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 690
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 691
Time: 0.003s">
<div class="time" style="width: 0.48231511254019%"></div>
<pre> exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 691
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 692
Time: 0.012s">
<div class="time" style="width: 1.9292604501608%"></div>
<pre> refine (finite_equiv _ (equiv_fin_equiv n n) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 692
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 693
Time: 0.01s">
<div class="time" style="width: 1.6077170418006%"></div>
<pre>

Definition fcard_aut `{Funext} X `{Finite X}
: fcard (X &lt;~&gt; X) = factorial (fcard X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 696
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 697
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 698
Time: 0.023s">
<div class="time" style="width: 3.6977491961415%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 699
Time: 0.026s">
<div class="time" style="width: 4.1800643086817%"></div>
<pre>
  refine (fcard_equiv
            (equiv_functor_equiv e^-1 e^-1)^-1 @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 701
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize (fcard X); intros n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 702
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 703
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 704
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 704
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 705
Time: 0.036s">
<div class="time" style="width: 5.7877813504823%"></div>
<pre> refine (fcard_equiv (equiv_fin_equiv n n)^-1 @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 705
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
    refine (fcard_prod _ _ @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 706
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply ap011.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 707
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 708
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 708
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 709
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> assumption.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 709
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 710
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** [fcard] still computes: *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 712
Time: 0.034s">
<div class="time" style="width: 5.4662379421222%"></div>
<pre>Goal forall fs:Funext, fcard (Fin 4 &lt;~&gt; Fin 4) = 24.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 712
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 713
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Abort.

(** ** Finite sums of natural numbers *)

(** Perhaps slightly less obviously, finite sets are also closed under sigmas. *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 719
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance finite_sigma {X} (Y : X -&gt; Type)
       `{Finite X} `{forall x, Finite (Y x)}
: Finite { x:X &amp; Y x }.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 721
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 722
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 723
Time: 0.018s">
<div class="time" style="width: 2.8938906752412%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 724
Time: 0.015s">
<div class="time" style="width: 2.411575562701%"></div>
<pre>
  refine (finite_equiv' _
            (equiv_functor_sigma (equiv_inverse e)
                                 (fun x (y:Y (e^-1 x)) =&gt; y)) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 727
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** Unfortunately, because [compose] is currently beta-expanded, [set (Y' := Y o e^-1)] doesn't change the goal. *)
 </pre>
</div>
<div class="code" title="File: Finite.v
Line: 729
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>set (Y' := fun x =&gt; Y (e^-1 x)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 729
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
  assert (forall x, Finite (Y' x)) by exact _; clearbody Y'; clear e.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 730
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize dependent (fcard X); intros n Y' ?.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 731
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 732
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 733
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> refine (finite_equiv Empty pr1^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 733
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 734
Time: 0.017s">
<div class="time" style="width: 2.7331189710611%"></div>
<pre> refine (finite_equiv _ (equiv_sigma_sum (Fin n) Unit Y')^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 734
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply finite_sum.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 735
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 736
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply IH; exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 736
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 737
Time: 0.007s">
<div class="time" style="width: 1.1254019292605%"></div>
<pre> refine (finite_equiv _ (equiv_contr_sigma _)^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 737
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 738
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Amusingly, this automatically gives us a way to add up a family of natural numbers indexed by any finite set.  (We could of course also define such an operation directly, probably using [merely_ind_hset].) *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 741
Time: 0.007s">
<div class="time" style="width: 1.1254019292605%"></div>
<pre>Definition finplus {X} `{Finite X} (f : X -&gt; nat) : nat
  := fcard { x:X &amp; Fin (f x) }.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 742
Time: 0.006s">
<div class="time" style="width: 0.96463022508039%"></div>
<pre>

Definition fcard_sigma {X} (Y : X -&gt; Type)
       `{Finite X} `{forall x, Finite (Y x)}
: fcard { x:X &amp; Y x } = finplus (fun x =&gt; fcard (Y x)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 746
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 747
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  set (f := fun x =&gt; fcard (Y x)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 748
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  set (g := fun x =&gt; merely_equiv_fin (Y x) : merely (Y x &lt;~&gt; Fin (f x))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 749
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply finite_choice in g.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 750
Time: 0.026s">
<div class="time" style="width: 4.1800643086817%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 751
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  unfold finplus.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 752
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (fcard_equiv' (equiv_functor_sigma_id g)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 753
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 754
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** The sum of a finite constant family is the product by its cardinality. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 756
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition finplus_const X `{Finite X} n
: finplus (fun x:X =&gt; n) = fcard X * n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 757
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 758
Time: 0.007s">
<div class="time" style="width: 1.1254019292605%"></div>
<pre>
  transitivity (fcard (X * Fin n)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 759
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 760
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (fcard_equiv' (equiv_sigma_prod0 X (Fin n))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 760
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 761
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> exact (fcard_prod X (Fin n)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 761
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 762
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Closure under sigmas and paths also implies closure under hfibers. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 764
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition finite_hfiber {X Y} (f : X -&gt; Y) (y : Y)
       `{Finite X} `{Finite Y}
: Finite (hfiber f y).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 766
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 767
Time: 0.014s">
<div class="time" style="width: 2.2508038585209%"></div>
<pre>
  exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 768
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 769
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Therefore, the cardinality of the domain of a map between finite sets is the sum of the cardinalities of its hfibers. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 771
Time: 0.016s">
<div class="time" style="width: 2.572347266881%"></div>
<pre>Definition fcard_domain {X Y} (f : X -&gt; Y) `{Finite X} `{Finite Y}
: fcard X = finplus (fun y =&gt; fcard (hfiber f y)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 772
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 773
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (_ @ fcard_sigma (hfiber f)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 774
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (fcard_equiv' (equiv_fibration_replacement f)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 775
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 776
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** In particular, the image of a map between finite sets is finite. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 778
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition finite_image
       {X Y} `{Finite X} `{Finite Y} (f : X -&gt; Y)
: Finite (himage f).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 780
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 781
Time: 0.031s">
<div class="time" style="width: 4.983922829582%"></div>
<pre>
  exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 782
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 783
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Finite products of natural numbers *)

(** Similarly, closure of finite sets under [forall] automatically gives us a way to multiply a family of natural numbers indexed by any finite set.  Of course, if we defined this explicitly, it wouldn't need funext. *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 788
Time: 0.017s">
<div class="time" style="width: 2.7331189710611%"></div>
<pre>Definition finmult `{Funext} {X} `{Finite X} (f : X -&gt; nat) : nat
  := fcard (forall x:X, Fin (f x)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 789
Time: 0.01s">
<div class="time" style="width: 1.6077170418006%"></div>
<pre>

Definition fcard_forall `{Funext} {X} (Y : X -&gt; Type)
       `{Finite X} `{forall x, Finite (Y x)}
: fcard (forall x:X, Y x) = finmult (fun x =&gt; fcard (Y x)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 793
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 794
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  set (f := fun x =&gt; fcard (Y x)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 795
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  set (g := fun x =&gt; merely_equiv_fin (Y x) : merely (Y x &lt;~&gt; Fin (f x))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 796
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply finite_choice in g.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 797
Time: 0.033s">
<div class="time" style="width: 5.3054662379421%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 798
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  unfold finmult.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 799
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (fcard_equiv' (equiv_functor_forall' (equiv_idmap X) g)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 800
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 801
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** The product of a finite constant family is the exponential by its cardinality. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 803
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>Definition finmult_const `{Funext} X `{Finite X} n
: finmult (fun x:X =&gt; n) = nat_exp n (fcard X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 804
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 805
Time: 0.036s">
<div class="time" style="width: 5.7877813504823%"></div>
<pre>
  refine (fcard_arrow X (Fin n)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 806
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 807
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>


(** ** Finite subsets *)

(** Closure under sigmas implies that a detachable subset of a finite set is finite. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 812
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance finite_detachable_subset {X} `{Finite X} (P : X -&gt; Type)
       `{forall x, IsHProp (P x)} `{forall x, Decidable (P x)}
: Finite { x:X &amp; P x }.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 814
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 815
Time: 0.006s">
<div class="time" style="width: 0.96463022508039%"></div>
<pre>
  exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 816
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 817
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Conversely, if a subset of a finite set is finite, then it is detachable.  We show first that an embedding between finite subsets has detachable image. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 819
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition detachable_image_finite
           {X Y} `{Finite X} `{Finite Y} (f : X -&gt; Y) `{IsEmbedding f}
: forall y, Decidable (hfiber f y).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 821
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 822
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros y.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 823
Time: 0.015s">
<div class="time" style="width: 2.411575562701%"></div>
<pre>
  assert (ff : Finite (hfiber f y)) by exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 824
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  destruct ff as [[|n] e].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 825
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 826
Time: 0.05s">
<div class="time" style="width: 8.0385852090032%"></div>
<pre> right; intros u; strip_truncations; exact (e u).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 826
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 827
Time: 0.046s">
<div class="time" style="width: 7.395498392283%"></div>
<pre> left; strip_truncations; exact (e^-1 (inr tt)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 827
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 828
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition detachable_finite_subset {X} `{Finite X}
           (P : X -&gt; Type) `{forall x, IsHProp (P x)}
           {Pf : Finite ({ x:X &amp; P x })}
: forall x, Decidable (P x).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 833
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 834
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros x.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 835
Time: 0.087s">
<div class="time" style="width: 13.987138263666%"></div>
<pre>
  refine (decidable_equiv _ (hfiber_fibration x P)^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 836
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (* The try clause below is only needed for Coq &lt;= 8.11 *)
 </pre>
</div>
<div class="code" title="File: Finite.v
Line: 838
Time: 0.008s">
<div class="time" style="width: 1.2861736334405%"></div>
<pre>refine (detachable_image_finite pr1 x); try assumption.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 838
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 839
Time: 0.007s">
<div class="time" style="width: 1.1254019292605%"></div>
<pre> apply (mapinO_pr1 (Tr (-1))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 839
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>  (** Why doesn't Coq find this? *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 839
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 839
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Quotients *)

(** The quotient of a finite set by a detachable equivalence relation is finite. *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 844
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section DecidableQuotients.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 844
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
  Context `{Univalence} {X} `{Finite X}
          (R : Relation X) `{is_mere_relation X R}
          `{Reflexive _ R} `{Transitive _ R} `{Symmetric _ R}
          {Rd : forall x y, Decidable (R x y)}.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 848
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Global Instance finite_quotient : Finite (Quotient R).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 850
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 851
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 852
Time: 0.055s">
<div class="time" style="width: 8.8424437299035%"></div>
<pre>
    strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 853
Time: 0.003s">
<div class="time" style="width: 0.48231511254019%"></div>
<pre>
    pose (R' x y := R (e^-1 x) (e^-1 y)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 854
Time: 0.004s">
<div class="time" style="width: 0.64308681672026%"></div>
<pre>
    assert (is_mere_relation _ R') by exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 855
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    assert (Reflexive R') by (intros ?; unfold R'; apply reflexivity).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 856
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    assert (Symmetric R') by (intros ? ?; unfold R'; apply symmetry).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 857
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    assert (Transitive R') by (intros ? ? ?; unfold R'; apply transitivity).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 858
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    assert (R'd : forall x y, Decidable (R' x y))
      by (intros ? ?; unfold R'; apply Rd).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 860
Time: 0.016s">
<div class="time" style="width: 2.572347266881%"></div>
<pre>
    srefine (finite_equiv' _ (equiv_quotient_functor R' R e^-1 _) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 861
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    1: by try (intros; split).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 862
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    clearbody R'; clear e.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 863
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
    generalize dependent (fcard X);
      intros n; induction n as [|n IH]; intros R' ? ? ? ? ?.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 865
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 866
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre> refine (finite_equiv Empty _^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 866
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
      refine (Quotient_rec R' _ Empty_rec (fun x _ _ =&gt; match x with end)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 867
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 868
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> pose (R'' x y := R' (inl x) (inl y)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 868
Time: 0.005s">
<div class="time" style="width: 0.80385852090032%"></div>
<pre>
      assert (is_mere_relation _ R'') by exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 869
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      assert (Reflexive R'') by (intros ?; unfold R''; apply reflexivity).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 870
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      assert (Symmetric R'') by (intros ? ?; unfold R''; apply symmetry).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 871
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      assert (Transitive R'') by (intros ? ? ?; unfold R''; apply transitivity).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 872
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      assert (forall x y, Decidable (R'' x y)) by (intros ? ?; unfold R''; apply R'd).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 873
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      assert (inlresp := (fun x y =&gt; idmap)
                         : forall x y, R'' x y -&gt; R' (inl x) (inl y)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 875
Time: 0.029s">
<div class="time" style="width: 4.6623794212219%"></div>
<pre>
      destruct (dec (merely {x:Fin n &amp; R' (inl x) (inr tt)})) as [p|np].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 876
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 877
Time: 0.228s">
<div class="time" style="width: 36.655948553055%"></div>
<pre> strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 877
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        destruct p as [x r].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 878
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
        refine (finite_equiv' (Quotient R'') _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 879
Time: 0.211s">
<div class="time" style="width: 33.922829581994%"></div>
<pre>
        refine (Build_Equiv _ _ (Quotient_functor R'' R' inl inlresp) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 880
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply isequiv_surj_emb.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 881
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 882
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply BuildIsSurjection.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 882
Time: 0.007s">
<div class="time" style="width: 1.1254019292605%"></div>
<pre>
          refine (Quotient_ind_hprop R' _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 883
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
          intros [y|[]]; apply tr.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 884
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 885
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exists (class_of R'' y); reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 885
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 886
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exists (class_of R'' x); simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 886
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
            apply qglue, r.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 887
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 888
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> apply isembedding_isinj_hset; intros u.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 888
Time: 0.022s">
<div class="time" style="width: 3.5369774919614%"></div>
<pre>
          refine (Quotient_ind_hprop R'' _ _); intros v.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 889
Time: 0.022s">
<div class="time" style="width: 3.5369774919614%"></div>
<pre>
          revert u; refine (Quotient_ind_hprop R'' _ _); intros u.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 890
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          simpl; intros q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 891
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          apply qglue; unfold R''.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 892
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
          exact (related_quotient_paths R' (inl u) (inl v) q).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 893
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 893
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 894
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre> refine (finite_equiv' (Quotient R'' + Unit) _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 894
Time: 0.016s">
<div class="time" style="width: 2.572347266881%"></div>
<pre>
        refine (Build_Equiv _ _ (sum_ind (fun _ =&gt; Quotient R')
                                        (Quotient_functor R'' R' inl inlresp)
                                        (fun _ =&gt; class_of R' (inr tt))) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 897
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply isequiv_surj_emb.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 898
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 899
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply BuildIsSurjection.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 899
Time: 0.01s">
<div class="time" style="width: 1.6077170418006%"></div>
<pre>
          refine (Quotient_ind_hprop R' _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 900
Time: 0.004s">
<div class="time" style="width: 0.64308681672026%"></div>
<pre>
          intros [y|[]]; apply tr.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 901
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 902
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> exists (inl (class_of R'' y)); reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 902
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 903
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exists (inr tt); reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 903
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 904
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> apply isembedding_isinj_hset; intros u.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 904
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          refine (sum_ind _ _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 905
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 906
Time: 0.097s">
<div class="time" style="width: 15.594855305466%"></div>
<pre> refine (Quotient_ind_hprop R'' _ _); intros v.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 906
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
            revert u; refine (sum_ind _ _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 907
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
            *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 908
Time: 0.048s">
<div class="time" style="width: 7.7170418006431%"></div>
<pre> refine (Quotient_ind_hprop R'' _ _); intros u.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 908
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
              simpl; intros q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 909
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
              apply ap, qglue; unfold R''.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 910
Time: 0.003s">
<div class="time" style="width: 0.48231511254019%"></div>
<pre>
              exact (related_quotient_paths R' (inl u) (inl v) q).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 911
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
            *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 912
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre> intros []; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 912
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
              intros q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 913
Time: 0.003s">
<div class="time" style="width: 0.48231511254019%"></div>
<pre>
              apply related_quotient_paths in q; try exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 914
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
              apply symmetry in q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 915
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
              elim (np (tr (v ; q))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 916
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 917
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre> intros []; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 917
Time: 0.004s">
<div class="time" style="width: 0.64308681672026%"></div>
<pre>
            destruct u as [u|[]]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 918
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
            *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 919
Time: 0.043s">
<div class="time" style="width: 6.9131832797428%"></div>
<pre> revert u; refine (Quotient_ind_hprop R'' _ _); intros u; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 919
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
              intros q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 920
Time: 0.003s">
<div class="time" style="width: 0.48231511254019%"></div>
<pre>
              apply related_quotient_paths in q; try exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 921
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
              elim (np (tr (u;q))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 922
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
            *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 923
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros; reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 923
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 923
Time: 0.046s">
<div class="time" style="width: 7.395498392283%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 924
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Therefore, the cardinality of [X] is the sum of the cardinalities of its equivalence classes. *)
 </pre>
</div>
<div class="code" title="File: Finite.v
Line: 927
Time: 0.108s">
<div class="time" style="width: 17.363344051447%"></div>
<pre>Definition fcard_quotient
  : fcard X = finplus (fun z:Quotient R =&gt; fcard {x:X &amp; in_class R z x}).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 928
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 929
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
    refine (fcard_domain (class_of R) @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 930
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
    apply ap, path_arrow; intros z; revert z.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 931
Time: 0.016s">
<div class="time" style="width: 2.572347266881%"></div>
<pre>
    refine (Quotient_ind_hprop _ _ _); intros x; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 932
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply fcard_equiv'; unfold hfiber.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 933
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    refine (equiv_functor_sigma_id _); intros y; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 934
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    symmetry.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 935
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    refine (path_quotient R y x oE _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 936
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
    apply equiv_iff_hprop; apply symmetry.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 937
Time: 0.003s">
<div class="time" style="width: 0.48231511254019%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 938
Time: 0.022s">
<div class="time" style="width: 3.5369774919614%"></div>
<pre>

End DecidableQuotients.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 940
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Injections *)

(** An injection between finite sets induces an inequality between their cardinalities. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 944
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>Definition leq_inj_finite `{Funext} {X Y} {fX : Finite X} {fY : Finite Y}
           (f : X -&gt; Y) (i : IsEmbedding f)
: fcard X &lt;= fcard Y.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 946
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 947
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (MapIn (Tr (-1)) f) by exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 948
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> clear i.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 948
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  destruct fX as [n e]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 949
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  destruct fY as [m e']; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 950
Time: 0.063s">
<div class="time" style="width: 10.128617363344%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 951
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
  pose (g := e' o f o e^-1).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 952
Time: 0.061s">
<div class="time" style="width: 9.8070739549839%"></div>
<pre>
  assert (MapIn (Tr (-1)) g) by (unfold g; exact _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 953
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  clearbody g.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 954
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> clear e e'.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 954
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> generalize dependent m.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 954
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IHn].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 955
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 956
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros; exact tt.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 956
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 956
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros m g ?.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 957
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (i : isinj g) by (apply isinj_embedding; exact _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 958
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  destruct m as [|m].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 959
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 960
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> elim (g (inr tt)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 960
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 960
Time: 0.006s">
<div class="time" style="width: 0.96463022508039%"></div>
<pre>
  pose (h := (fin_transpose_last_with m (g (inr tt)))^-1 o g).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 961
Time: 0.064s">
<div class="time" style="width: 10.289389067524%"></div>
<pre>
  assert (MapIn (Tr (-1)) h) by (unfold h; exact _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 962
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (Ha : forall a:Fin n, is_inl (h (inl a))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 963
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 964
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros a.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 964
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    remember (g (inl a)) as b eqn:p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 965
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
    destruct b as [b|[]].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 966
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 967
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> assert (q : g (inl a) &lt;&gt; (g (inr tt))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 967
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 968
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros r.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 968
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (inl_ne_inr _ _ (i _ _ r)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 968
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 968
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      rewrite p in q; apply symmetric_neq in q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 969
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      assert (r : h (inl a) = inl b).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 970
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 971
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> unfold h; apply moveR_equiv_V; symmetry.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 971
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        refine (fin_transpose_last_with_rest m (g (inr tt)) b q @ p^).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 972
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 972
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      rewrite r; exact tt.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 973
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 974
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> assert (q : h (inl a) = g (inr tt)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 974
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 975
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> unfold h; apply moveR_equiv_V; symmetry.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 975
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        refine (_ @ p^); apply fin_transpose_last_with_with.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 976
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 976
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      rewrite q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 977
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
      destruct (is_inl_or_is_inr (g (inr tt))) as [l|r]; try assumption.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 978
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      assert (s := inr_un_inr _ r).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 979
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
      revert s; generalize (un_inr (g (inr tt)) r); intros [] s.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 980
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
      elim (inl_ne_inr _ _ (i _ _ (p @ s))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 981
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 981
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (Hb : forall b:Unit, is_inr (h (inr b))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 982
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 983
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros [].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 983
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    assert (q : h (inr tt) = inr tt).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 984
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 985
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> unfold h; apply moveR_equiv_V; symmetry.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 985
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply fin_transpose_last_with_last.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 986
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 986
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    rewrite q; exact tt.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 987
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 987
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
  exact (IHn m (unfunctor_sum_l h Ha)
             (mapinO_unfunctor_sum_l (Tr (-1)) h Ha Hb)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 989
Time: 0.01s">
<div class="time" style="width: 1.6077170418006%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 990
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Initial segments of [nat] *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 993
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition nat_fin (n : nat) (k : Fin n) : nat.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 993
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 994
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n nf].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 995
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 996
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> contradiction.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 996
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 997
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> destruct k as [k|_].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 997
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 998
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (nf k).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 998
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 999
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 999
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1000
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition nat_fin_inl (n : nat) (k : Fin n)
: nat_fin n.+1 (inl k) = nat_fin n k
  := 1.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1004
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition nat_fin_compl (n : nat) (k : Fin n) : nat.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1006
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1007
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n nfc].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1008
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1009
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> contradiction.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1009
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1010
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> destruct k as [k|_].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1010
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1011
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (nfc k).+1.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1011
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1012
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact 0.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1012
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1013
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition nat_fin_compl_compl n k
: (nat_fin n k + nat_fin_compl n k).+1 = n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1016
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1017
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1018
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1019
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> contradiction.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1019
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1020
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> destruct k as [k|?]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1020
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1021
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> rewrite nat_plus_comm.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1021
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      specialize (IH k).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1022
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      rewrite nat_plus_comm in IH.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1023
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (ap S IH).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1024
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1025
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> rewrite nat_plus_comm; reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1025
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1026
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Enumerations *)

(** A function from [nat] to a finite set must repeat itself eventually. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1030
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section Enumeration.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1030
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context `{Funext} {X} `{Finite X} (e : nat -&gt; X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1031
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Let er (n : nat) : Fin n -&gt; X
    := fun k =&gt; e (nat_fin n k).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1034
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Lemma finite_enumeration_stage (n : nat)
  : IsEmbedding (er n)
    + { n : nat &amp; { k : nat &amp; e n = e (n + k).+1 }}.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1038
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1039
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    induction n as [|n [IH|IH]].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1040
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1041
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> left.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1041
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros x.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1041
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply hprop_inhabited_contr; intros [[] _].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1042
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1043
Time: 0.003s">
<div class="time" style="width: 0.48231511254019%"></div>
<pre> destruct (detachable_image_finite (er n) (er n.+1 (inr tt)))
        as [[k p]|ne].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1044
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1045
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> right.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1045
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        exists (nat_fin n k).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1046
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        exists (nat_fin_compl n k).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1047
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        rewrite nat_fin_compl_compl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1048
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        exact p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1049
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1050
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> left.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1050
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros x.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1050
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply hprop_allpath.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1051
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        intros k l.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1052
Time: 0.019s">
<div class="time" style="width: 3.0546623794212%"></div>
<pre>
        apply path_sigma_hprop.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1053
Time: 0.005s">
<div class="time" style="width: 0.80385852090032%"></div>
<pre>
        destruct k as [[k|[]] p], l as [[l|[]] q]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1054
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1055
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply isinj_embedding in IH.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1055
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          apply ap.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1056
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          apply IH.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1057
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          unfold er in p, q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1058
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> simpl in p, q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1058
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          exact (p @ q^).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1059
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1060
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine (Empty_rec (ne _)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1060
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          exists k.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1061
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          exact (p @ q^).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1062
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1063
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine (Empty_rec (ne _)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1063
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          exists l.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1064
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          exact (q @ p^).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1065
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1066
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1066
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1067
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> right; exact IH.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1067
Time: 0.003s">
<div class="time" style="width: 0.48231511254019%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1068
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition finite_enumeration_repeats
  : { n : nat &amp; { k : nat &amp; e n = e (n + k).+1 }}.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1071
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1072
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre>
    destruct (finite_enumeration_stage (fcard X).+1) as [p|?].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1073
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1074
Time: 0.001s">
<div class="time" style="width: 0.16077170418006%"></div>
<pre> assert (q := leq_inj_finite (er (fcard X).+1) p); simpl in q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1074
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      elim (not_nltn _ q).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1075
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1076
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> assumption.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1076
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1077
Time: 0.003s">
<div class="time" style="width: 0.48231511254019%"></div>
<pre>

End Enumeration.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1079
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** [fsucc_mod] is the successor function mod n *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1081
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition fsucc_mod {n : nat} : Fin n -&gt; Fin n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1081
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1082
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  destruct n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1083
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  1: exact idmap.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1084
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros [x|].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1085
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1086
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (fsucc x).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1086
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1087
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact fin_zero.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1087
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1088
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** fsucc allows us to convert a natural number into an element of a finite set. This can be thought of as the modulo map. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1090
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Fixpoint fin_nat {n : nat} (m : nat) : Fin n.+1
  := match m with
      | 0 =&gt; fin_zero
      | S m =&gt; fsucc_mod (fin_nat m)
     end.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1094
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** TODO: Would this notation be useful? *)
(* Notation "[ n ]" := (fin_nat n). *)

(** ** Tactics *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1100
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Ltac FinIndOn X := repeat
  match type of X with
  | Fin 0 =&gt; destruct X
  | Empty =&gt; destruct X
  | Unit =&gt; destruct X
  | Fin ?n =&gt; destruct X as [X|X]
  | ?L + Unit =&gt; destruct X as [X|X]
  end.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1107
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** This tactic can be used to generate n cases from a goal like forall (x : Fin n), _ *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1109
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Ltac FinInd := let X := fresh "X" in intro X; FinIndOn X.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1109
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** The 1-dimensional version of Sperner's lemma says that given any finite sequence of decidable hProps, where the sequence starts with true and ends with false, we can find a point in the sequence where the sequence changes from true to false. This is like a discrete intermediate value theorem. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1111
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Fixpoint sperners_lemma_1d {n} :
  forall (f : Fin (n.+2) -&gt; DHProp)
         (left_true : f fin_zero)
         (right_false : ~ f fin_last),
    {k : Fin n.+1 &amp; f (fin_incl k) /\ ~ f (fsucc k)}.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1115
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1116
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros ???.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1117
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  destruct n as [|n].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1118
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1119
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exists fin_zero.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1119
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> split; assumption.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1119
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1120
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre> destruct (dec (f (fin_incl fin_last))) as [prev_true|prev_false].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1120
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1121
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exists fin_last.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1121
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> split; assumption.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1121
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1122
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre> destruct (sperners_lemma_1d _ (f o fin_incl) left_true prev_false) as [k' [fleft fright]].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1122
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exists (fin_incl k').</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1123
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      split; assumption.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1124
Time: 0.002s">
<div class="time" style="width: 0.32154340836013%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1126
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

</pre>
</div>
</body>
</html>

